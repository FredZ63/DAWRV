<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ATLAS - MIDI Patch Librarian</title>
    <!-- Shared styles live outside the renderer bundle -->
    <link rel="stylesheet" href="../../shared/ui/styles/main.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-left">
            <h1>üèîÔ∏è ATLAS</h1>
            <span class="tagline">Holding Your Patch Universe</span>
        </div>
        <div class="header-center">
            <div class="protocol-badge" id="protocol-badge">
                <span class="protocol-icon">üéπ</span>
                <span class="protocol-text">Initializing...</span>
            </div>
        </div>
        <div class="header-right">
            <div class="daw-status" id="daw-status">
                <span class="daw-icon">üîå</span>
                <span class="daw-text">No DAW Connected</span>
            </div>
            <div class="stats" id="stats">
                <span class="stat-item">
                    <strong id="patch-count">0</strong> patches
                </span>
                <span class="stat-item">
                    <strong id="device-count">0</strong> devices
                </span>
                <span class="stat-item">
                    <strong id="plugin-count">0</strong> plugins
                </span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar - Device Panel -->
        <aside class="sidebar">
            <div class="sidebar-section">
                <div class="section-header">
                    <h2>Devices</h2>
                    <button class="btn-icon" id="refresh-devices" title="Discover Devices">üîÑ</button>
                </div>
                <div class="sidebar-filters" id="device-filters">
                    <select id="device-manufacturer-filter" class="filter-select filter-select--compact" title="Manufacturer">
                        <option value="">All manufacturers</option>
                    </select>
                    <select id="device-model-filter" class="filter-select filter-select--compact" title="Model">
                        <option value="">All models</option>
                    </select>
                    <details class="manual-pairing" id="manual-pairing">
                        <summary class="manual-pairing-summary">Manual MIDI pairing</summary>
                        <div class="manual-pairing-body">
                            <select id="manual-output-port" class="filter-select filter-select--compact" title="Output port">
                                <option value="">Output port‚Ä¶</option>
                            </select>
                            <select id="manual-input-port" class="filter-select filter-select--compact" title="Input port">
                                <option value="">Input port‚Ä¶</option>
                            </select>
                            <div class="manual-pairing-actions">
                                <button class="btn-primary btn-primary--compact" id="manual-connect-btn">Connect</button>
                                <button class="btn-small" id="manual-reset-btn" type="button">Reset</button>
                            </div>
                            <div class="sidebar-hint">Use this if your device has separate ports (e.g. ‚ÄúDAW CTRL‚Äù) or ATLAS can‚Äôt auto-pair input/output.</div>
                        </div>
                    </details>
                    <div class="sidebar-hint" id="device-filter-hint">
                        Tip: filters help you find devices; ATLAS can only connect to devices detected by macOS MIDI.
                    </div>
                </div>
                <div class="device-list" id="device-list">
                    <div class="empty-state">
                        <p>No devices connected</p>
                        <button class="btn-primary" id="discover-devices">
                            Discover Devices
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h2>Plugins</h2>
                    <button class="btn-icon" id="toggle-plugin-categories" title="Collapse/Expand plugin categories">
                        ‚ñæ
                    </button>
                    <button class="btn-icon" id="refresh-plugins" title="Scan for Plugins">
                        üîå
                    </button>
                </div>
                <div class="sidebar-search">
                    <input
                        type="text"
                        id="plugin-search"
                        class="search-input search-input--compact"
                        placeholder="Search plugins‚Ä¶"
                    >
                </div>
                <div class="plugin-action-bar" id="plugin-action-bar" style="display:none;">
                    <div class="plugin-action-title">
                        <span class="plugin-action-label">Selected</span>
                        <span class="plugin-action-name" id="selected-plugin-name">‚Äî</span>
                    </div>
                    <div class="plugin-action-controls">
                        <select id="extract-limit" class="filter-select filter-select--compact" title="How many to extract">
                            <option value="25">Extract 25</option>
                            <option value="100">Extract 100</option>
                            <option value="500">Extract 500</option>
                        </select>
                        <button class="btn-primary btn-primary--compact" id="extract-selected">
                            Extract
                        </button>
                        <button class="btn-small" id="view-selected-presets" title="View extracted presets for this plugin">
                            View Presets
                        </button>
                    </div>
                    <div class="plugin-action-hint" id="plugin-action-hint"></div>
                </div>
                <div class="plugin-list" id="plugin-list">
                    <div class="empty-state">
                        <p>No plugins found</p>
                        <button class="btn-primary" id="discover-plugins">
                            Scan for Plugins
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h2>Quick Actions</h2>
                </div>
                <div class="quick-actions">
                    <button class="btn-action" id="btn-new-patch">
                        üìù New Patch
                    </button>
                    <button class="btn-action" id="btn-import">
                        üì• Import
                    </button>
                    <button class="btn-action" id="btn-export">
                        üì§ Export
                    </button>
                    <button class="btn-action" id="btn-backup">
                        üíæ Backup Device
                    </button>
                    <button class="btn-action btn-action--danger" id="btn-clear-library">
                        üßπ Clear Library
                    </button>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="section-header">
                    <h2>DAW Integration</h2>
                </div>
                <div class="daw-integration">
                    <button class="btn-daw" data-daw="reaper">
                        <span aria-hidden="true">üéõÔ∏è</span>
                        <span>REAPER</span>
                    </button>
                    <button class="btn-daw" data-daw="ableton">
                        <span aria-hidden="true">üéöÔ∏è</span>
                        <span>Ableton Live</span>
                    </button>
                    <button class="btn-daw" data-daw="logic">
                        <span aria-hidden="true">üéº</span>
                        <span>Logic Pro</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="content">
            <!-- Search and Filters -->
            <div class="toolbar">
                <div class="view-tabs">
                    <button class="view-tab is-active" id="tab-library">Library</button>
                    <button class="view-tab" id="tab-device" style="display:none;">Device</button>
                    <button class="view-tab" id="tab-knowledge">Knowledge</button>
                    <button class="view-tab-icon" id="btn-copilot-settings" title="Copilot Settings">‚öôÔ∏è</button>
                </div>
                <div class="search-bar">
                    <input 
                        type="text" 
                        id="search-input" 
                        placeholder="Search patches by name, category, or tags..." 
                        class="search-input"
                    >
                    <button class="btn-icon" id="search-btn">üîç</button>
                </div>
                <div class="filters">
                    <div class="filter-tabs" id="plugin-filter-tabs">
                        <button class="filter-tab is-active" id="plugin-filter-tab-types" type="button">Plugin Types</button>
                        <button class="filter-tab" id="plugin-filter-tab-vendors" type="button">Plugin Vendors</button>
                    </div>
                    <select id="category-filter" class="filter-select">
                        <option value="">All Categories</option>
                    </select>
                    <select id="device-filter" class="filter-select">
                        <option value="">All Devices</option>
                    </select>
                    <select id="plugin-category-filter" class="filter-select">
                        <option value="">All Plugin Types</option>
                        <option value="instrument">üéπ Instruments</option>
                        <option value="fx">‚ú® FX</option>
                        <option value="outboard">üéöÔ∏è Signal Processing</option>
                        <option value="guitar">üé∏ Guitar</option>
                        <option value="miditools">üéµ MIDI Tools</option>
                        <option value="mastering">üéõÔ∏è Mastering</option>
                        <option value="analyzer">üìä Analyzer</option>
                        <option value="saturation">üî• Saturation</option>
                        <option value="synth">üéπ Synth</option>
                        <option value="sampler">üì¶ Sampler</option>
                        <option value="drum">ü•Å Drum</option>
                    </select>
                    <select id="plugin-vendor-filter" class="filter-select" style="display:none;">
                        <option value="">All Plugin Vendors</option>
                    </select>
                    <button class="btn-small" id="plugin-vendor-presets-btn" type="button" style="display:none;" title="Show extracted preset patches for this vendor">
                        Presets
                    </button>
                    <select id="sort-by" class="filter-select">
                        <option value="lastUsed">Recently Used</option>
                        <option value="name">Name</option>
                        <option value="rating">Rating</option>
                    </select>
                </div>
            </div>

            <!-- Library View (Patch Browser + Copilot Drawer) -->
            <div class="library-view" id="library-view">
                <div class="plugin-presets-bar" id="plugin-presets-bar" style="display:none;">
                    <div class="plugin-presets-title">
                        <span class="plugin-presets-label" id="plugin-presets-label">Plugin Presets</span>
                        <span class="plugin-presets-name" id="plugin-presets-name">‚Äî</span>
                    </div>
                    <div class="plugin-presets-controls">
                        <input type="text" id="plugin-presets-search" class="search-input search-input--compact" placeholder="Search presets‚Ä¶" />
                        <button class="btn-small" id="plugin-presets-clear" title="Clear preset view">Clear</button>
                    </div>
                </div>
                <!-- Patch Browser -->
                <div class="patch-browser" id="patch-browser">
                    <div class="empty-state">
                        <h3>No patches found</h3>
                        <p>Import patches or read them from your connected devices</p>
                    </div>
                </div>

                <!-- Copilot Drawer (Library) -->
                <aside class="copilot-drawer" id="copilot-drawer" style="display:none;">
                    <div class="copilot-drawer-header">
                        <div class="copilot-drawer-title">
                            <div class="copilot-drawer-eyebrow">Copilot</div>
                            <div class="copilot-drawer-heading" id="copilot-drawer-heading">Similar</div>
                        </div>
                        <button class="btn-icon" id="copilot-drawer-close" title="Close">‚úï</button>
                    </div>
                    <div class="copilot-drawer-body" id="copilot-drawer-body"></div>
                </aside>
            </div>

            <!-- Knowledge -->
            <div class="knowledge-view" id="knowledge-view" style="display:none;">
                <div class="knowledge-toolbar">
                    <button class="btn-primary btn-primary--compact" id="btn-knowledge-import">Import Files</button>
                    <button class="btn-action btn-action--danger" id="btn-knowledge-clear">Clear Knowledge</button>
                    <div class="knowledge-spacer"></div>
                    <input class="search-input" id="knowledge-search" placeholder="Search knowledge (manuals, docs, notes)‚Ä¶">
                    <button class="btn-icon" id="knowledge-search-btn" title="Search">üîç</button>
                </div>

                <div class="knowledge-grid">
                    <div class="knowledge-panel">
                        <div class="knowledge-panel-title">Add Knowledge</div>
                        <input class="knowledge-input" id="knowledge-title" placeholder="Title (e.g. ‚ÄòUADx MiniMoog Manual‚Äô)">
                        <input class="knowledge-input" id="knowledge-source" placeholder="Source (optional: manufacturer, URL, file name)">
                        <textarea class="knowledge-textarea" id="knowledge-content" placeholder="Paste text here (manual excerpt, release notes, tips)‚Ä¶"></textarea>
                        <button class="btn-primary" id="btn-knowledge-save">Save</button>
                        <div class="knowledge-hint">Local-first: everything is stored on your machine.</div>
                    </div>

                    <div class="knowledge-panel">
                        <div class="knowledge-panel-title">Ask Atlas</div>
                        <input class="knowledge-input" id="copilot-question" placeholder="Ask: ‚ÄòWhich compressor for lo-fi hip-hop vocals?‚Äô">
                        <input class="knowledge-input" id="copilot-genre" placeholder="Genre (optional: techno, hip-hop, rock‚Ä¶)">
                        <button class="btn-primary" id="btn-copilot-ask">Ask</button>
                        <div class="copilot-answer" id="copilot-answer"></div>
                    </div>

                    <div class="knowledge-panel knowledge-panel--wide">
                        <div class="knowledge-panel-title">Library</div>
                        <div class="knowledge-list" id="knowledge-list"></div>
                        <div class="knowledge-results" id="knowledge-results"></div>
                    </div>
                </div>
            </div>

            <!-- Device Librarian -->
            <div class="device-view" id="device-view" style="display:none;">
                <div class="device-librarian">
                    <div class="device-librarian-header">
                        <div class="device-librarian-title" id="device-librarian-title">No device connected</div>
                        <div class="device-librarian-actions">
                            <button class="btn-small" id="device-import-help">Import Help</button>
                            <button class="btn-small" id="device-import-manual">Import Manual PDF</button>
                            <button class="btn-small" id="device-import-sysex">Capture SysEx</button>
                            <button class="btn-small" id="device-set-import">Import Set</button>
                            <button class="btn-primary btn-primary--compact" id="device-set-create">New Set</button>
                            <button class="btn-primary btn-primary--compact" id="device-set-add-selected">Add Selected</button>
                            <button class="btn-small" id="device-set-rename">Rename</button>
                            <button class="btn-small" id="device-set-delete">Delete</button>
                            <button class="btn-small" id="device-set-export">Export</button>
                            <button class="btn-small" id="device-set-send">Send Set</button>
                        </div>
                    </div>
                    <div class="device-librarian-grid">
                        <div class="device-librarian-panel">
                            <div class="device-librarian-panel-title">Patches</div>
                            <div class="device-librarian-list" id="device-patch-list"></div>
                        </div>
                        <div class="device-librarian-panel">
                            <div class="device-librarian-panel-title">Sets (Bundles)</div>
                            <div class="device-librarian-list" id="device-set-list"></div>
                            <div class="device-librarian-panel-title" style="margin-top:14px;">Set Contents</div>
                            <div class="device-librarian-list" id="device-set-items"></div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
        <div class="status-left">
            <span id="status-message">Ready</span>
        </div>
        <div class="status-right">
            <span class="device-connection" id="selected-device">
                <span class="midi-activity-dot is-off" id="midi-activity-dot" title="MIDI activity (incoming)"></span>
                <span id="selected-device-text">No device selected</span>
            </span>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="scripts/atlas-ui.js"></script>
</body>
</html>
